@using System.Web.Optimization
@model StockSharer.Web.ViewModels.TownSearchResultsViewModel
@{
    ViewBag.Title = "Games to rent in " + Model.Town;
}

<div class="content-page">
    <div class="container content-page-inner">
        <div class="row">
            <div class="col-xs-12">
                <div class="content-page-header">
                    <h1>Games to rent in Lisburn</h1>
                    <p>Vis et nisl labores, no vis probo erant. Ei homero reprimique vix. Saperet legimus salutatus has in. Pro munere maiorum no, sed idque similique at.</p>
                    <p>No vim latine phaedrum dissentiet. Reque viris nominavi pro an, eu atqui postea dissentiunt nec. Praesent qualisque urbanitas ex vel. Vix an prodesset adolescens.</p>
                </div>
                
                <div class="row">   
                    <div class="col-sm-3">
                        <div class="result-filter">
                            <h2>@Model.SearchResults.Count games found</h2>
                            <form data-toggle="validator" method="GET">
                                <div class="form-group">
                                    <label>Platform</label>
                                    <select class="form-control" name="platformid">
                                        <option value="">Any</option>
                                        <option selected="@(Model.SearchFilter.PlatformId == 1)" value="1">Xbox One</option>
                                        <option selected="@(Model.SearchFilter.PlatformId == 4)" value="4">PS4</option>
                                        <option selected="@(Model.SearchFilter.PlatformId == 2)" value="2">Xbox 360</option>
                                        <option selected="@(Model.SearchFilter.PlatformId == 3)" value="3">PS3</option>
                                    </select>
                                    <span class="help-block with-errors"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label>Status</label>
                                    <select class="form-control" name="stocktypeid">
                                        <option value="">Any</option>
                                        <option selected="@(Model.SearchFilter.StockTypeId == 1)" value="1">Available</option>
                                        <option selected="@(Model.SearchFilter.StockTypeId == 2)" value="2">On loan</option>
                                    </select>
                                    <span class="help-block with-errors"></span>
                                </div>
                                
                                <div class="form-group">
                                    <label>Lender</label>
                                    <select class="form-control" name="storetypeid">
                                        <option value="">Any</option>
                                        <option selected="@(Model.SearchFilter.StoreTypeId == 1)" value="1">Private</option>
                                        <option selected="@(Model.SearchFilter.StoreTypeId == 2)" value="2">Business</option>
                                    </select>
                                    <span class="help-block with-errors"></span>
                                </div>
                                    
                                <div class="form-group">
                                    <input type="submit" class="btn btn-block btn-primary" value="Search"/>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="row">
                            @if (!Model.SearchResults.Any())
                            {
                                <h2>No results found, please refine your search</h2>
                            }
                            @foreach (var searchResult in Model.SearchResults)
                            {
                                <div class="col-sm-6 col-md-4">
                                    <div class="result-holder">
                                        <h3 title="@searchResult.GameName">@searchResult.GameName</h3>
                                        <div class="result-image">
                                            <img class="center-block" src="@searchResult.ImageUrl">
                                        </div>
                                        <div class="result-footer">
                                            <p>Duo ubique civibus officiis no, legimus fastidii euripidis vel no. Dicant aperiri nostrum vim ei. Ex vix aliquid evertitur efficiendi. Id sed idque harum postea, at erat putent vim. Et has timeam dolorem, mei ei nominati concludaturque, ei vel feugiat molestie hendrerit.</p>
                                            <div class="result-meta">
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td><strong>Date added:</strong></td>
                                                            <td>@searchResult.DateAdded.ToShortDateString()</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Type:</strong></td>
                                                            <td>@searchResult.StockTypeName</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Platform:</strong></td>
                                                            <td>@searchResult.PlatformName</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Price:</strong></td>
                                                            <td>@string.Format("{0:C}", searchResult.Price) / night</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Town:</strong></td>
                                                            <td>@searchResult.TownName</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Status:</strong></td>
                                                            <td>@searchResult.StockStatusName</td>
                                                        </tr>
                                                    </tbody></table>
                                            </div>
                                            <div class="result-cta">
                                                <a class="btn btn-block js-btn-availability" data-name="@searchResult.GameName" data-reference="51382b5c-6b3b-4680-8882-ece0385987d8" data-requested-today="false" data-owns-game="false"><i class="fa fa-calendar pull-left"></i>Check Availability</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="availabilityModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="availabilityRequest" method="POST" action="/Availability/SubmitRequest">
                @Html.AntiForgeryToken()
                <input type="hidden" name="Reference" value=""/>
                <input type="hidden" name="EndDate" value=""/>
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title js-availability-request-header">Game request</h4>
                </div>
                <div class="modal-body">
                    <p>Please select the dates you would like to rent your game and press submit.</p>
                    <p>The owner will be notified of your request and can decide to accept or reject.</p>
                    <div class="form-group js-no-request-made">
                        <label for="dateRange">Select date:</label>
                        <div id="dateRange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
                            <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;
                            <span></span> <b class="caret"></b>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-info btn-block js-no-request-made">Submit request</button>
                    <p class="js-request-made text-center text-success" style="display: none;">The user has been notified of your request</p>
                    <p class="js-owns-game text-center text-warning" style="display: none;">You own this game and cannot request it</p>
                </div>
            </form>
        </div>
    </div>
</div>

@section styles
{
    @Styles.Render("~/bundles/styles/search")
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
}

@section scripts{
    <script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
    @Scripts.Render("~/bundles/scripts/search")
    <script type="text/javascript">
        var loggedIn = @(User != null ? "true;" : "false;")
    </script>
}